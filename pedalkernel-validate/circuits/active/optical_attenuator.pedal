# Optical Attenuator - VTL5C3 Photocoupler
# Variable attenuator using light-dependent resistor (LDR)
#
# The VTL5C3 is a Vactrol (LED + LDR in one package):
# - LED current controls light output
# - LDR resistance varies with light (~1M dark, ~1k lit)
# - Creates smooth, "organic" volume control
#
# Used in:
# - LA-2A compressor (sidechain controls LED)
# - Tremolo (LFO controls LED)
# - Uni-Vibe (LFO + phase network)
#
# This test uses a fixed LED current to verify LDR behavior.
# For dynamic tests, sidechain modulation would control the LED.

pedal "Optical Attenuator" {
  supply 9V
  components {
    # Input coupling
    C_in: cap(100n)

    # Photocoupler
    OC1: photocoupler(vtl5c3)

    # LED drive circuit
    R_led: resistor(1k)       # LED current limiter

    # LDR voltage divider
    # OC1.ldr forms bottom of divider
    R_top: resistor(10k)      # Top of divider

    # Output buffer
    C_out: cap(100n)
    R_out: resistor(10k)

    # Control voltage for LED (simulates sidechain)
    R_ctrl: resistor(100k)
  }
  nets {
    # Input through coupling cap
    in -> C_in.a
    C_in.b -> R_top.a

    # Voltage divider: R_top in series with LDR
    R_top.b -> OC1.ldr_a, C_out.a

    # LDR to ground
    OC1.ldr_b -> gnd

    # LED drive (fixed current for this test)
    # In real compressor, this would be sidechain-controlled
    vcc -> R_led.a
    R_led.b -> OC1.led_a
    OC1.led_b -> R_ctrl.a
    R_ctrl.b -> gnd

    # Output
    C_out.b -> R_out.a, out
    R_out.b -> gnd
  }
}
