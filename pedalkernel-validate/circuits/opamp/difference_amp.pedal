# Difference Amplifier
# Amplifies the difference between two inputs
# For testing, V2 = 0 (grounded), so Vout = Vin
# With R1 = R2 = R3 = R4 = 10k: Vout = (R4/R3) * V1 = V1

pedal "Difference Amplifier" {
  components {
    U1: opamp(tl072)
    R1: resistor(10k)   # Input 1 resistor (to inverting)
    R2: resistor(10k)   # Feedback resistor
    R3: resistor(10k)   # Input 2 resistor (to non-inverting, grounded)
    R4: resistor(10k)   # Ground resistor on non-inverting side
  }
  nets {
    # Input 1 through R1 to inverting input
    in -> R1.a
    R1.b -> U1.neg

    # Feedback from output to inverting input
    U1.out -> R2.a
    R2.b -> U1.neg

    # Input 2 (grounded) through R3 to non-inverting input
    gnd -> R3.a
    R3.b -> U1.pos

    # R4 from non-inverting to ground
    U1.pos -> R4.a
    R4.b -> gnd

    # Output
    U1.out -> out
  }
}
